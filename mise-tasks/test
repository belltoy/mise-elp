#!/usr/bin/env bash
#MISE description="Run plugin tests - install and execute tool"
set -euo pipefail

# version="otp-27.3-2025-11-04"
release_date="2025-11-04"
otp_version="otp-27.3"
version="${otp_version}-${release_date}"

mise plugin link --force elp .
mise cache clear
mise install elp@${version}

# Capture and display the output while also verifying it
output=$(mise exec "elp@${version}" -- "elp" version)
echo "elp output: $output"

if echo "$output" | grep -q "elp.*${release_date}"; then
    echo "✓ Tests passed"
else
    echo "✗ Test failed: expected version elp@${version}"
    exit 1
fi
